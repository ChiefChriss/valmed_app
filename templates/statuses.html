{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="h3 mb-0">Task Statuses</h2>
  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addStatusModal">
    <i class="bi bi-plus-lg me-2"></i> Add Status
  </button>
</div>

<div class="card shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0 align-middle">
        <thead class="table-light">
          <tr>
            <th class="ps-4">Label</th>
            <th>Default</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for s in statuses %}
          <tr>
            <td class="ps-4 fw-medium">
              <span class="badge rounded-pill bg-light text-dark border px-3 py-2">{{ s.label }}</span>
            </td>
            <td>
              {% if s.is_default %}
              <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i> Default</span>
              {% else %}
              <span class="text-muted small">-</span>
              {% endif %}
            </td>
            <td>
              <div class="d-flex gap-2">
                <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal"
                  data-bs-target="#editStatusModal{{ s.id }}">
                  <i class="bi bi-pencil"></i> Edit
                </button>
                <form method="POST" action="{{ url_for('delete_status', status_id=s.id) }}"
                  onsubmit="return confirm('Are you sure?');">
                  <button class="btn btn-sm btn-outline-danger">
                    <i class="bi bi-trash"></i>
                  </button>
                </form>
              </div>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="3" class="text-center py-4 text-muted">No statuses found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Edit Status Modals -->
{% for s in statuses %}
<div class="modal fade" id="editStatusModal{{ s.id }}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Status</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="POST" action="{{ url_for('edit_status', status_id=s.id) }}">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Label</label>
            <input class="form-control" name="label" value="{{ s.label }}" required>
          </div>
          <div class="mb-3">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" name="is_default" value="1" id="editDefault{{ s.id }}" {%
                if s.is_default %}checked{% endif %}>
              <label class="form-check-label" for="editDefault{{ s.id }}">Set as Default Status</label>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endfor %}

<!-- Add Status Modal -->
<div class="modal fade" id="addStatusModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Status</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="POST" action="{{ url_for('add_status') }}">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Label</label>
            <input class="form-control" name="label" placeholder="e.g. Review, Blocked" required>
          </div>
          <div class="mb-3">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" name="is_default" value="1" id="is_default">
              <label class="form-check-label" for="is_default">Set as Default Status</label>
            </div>
            <div class="form-text">New tasks will automatically be assigned this status.</div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Add Status</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}